<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Test Inicial de Tiros</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      margin: 0; padding: 1rem;
    }
    h1 {
      font-size: 2rem;
      margin-bottom: 1rem;
      border-bottom: 2px solid #444;
      padding-bottom: 0.3rem;
    }
    .zone-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1rem;
    }
    .zone-card {
      background: #222;
      padding: 0.8rem 1rem;
      border: 1px solid #444;
      border-radius: 8px;
    }
    .zone-card label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: bold;
    }
    .zone-card input[type="number"] {
      width: 100%;
      padding: 0.4rem;
      border-radius: 4px;
      border: 1px solid #555;
      background: #111;
      color: #eee;
      font-size: 1rem;
    }
    .zone-card input[type="number"]::-webkit-inner-spin-button,
    .zone-card input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    .zone-card input[type="number"] {
      -moz-appearance: textfield;
    }
    #submit-btn {
      margin-top: 1.5rem;
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      background: #28a745;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #submit-btn:disabled {
      opacity: 0.6;
      cursor: default;
    }
    #message {
      margin-top: 1rem;
      font-size: 1rem;
    }
  </style>
</head>
<body>

  <h1>Test Inicial de Tiros: 10 tiros por zona</h1>
  <p>Introduce el número de aciertos (de 0 a 10) para cada combinación de posición + ángulo.</p>

  <div id="zones-container" class="zone-grid">
    <!-- Se generará dinámicamente -->
  </div>

  <button id="submit-btn">Guardar resultados</button>
  <div id="message"></div>

  <!-- Firebase v9 modular SDK desde CDN -->
  <script type="module">
    // Importa Firebase modular desde CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // --------------------------------------------------
    // AQUÍ COMPLETA CON TU CONFIG DE FIREBASE:
   const firebaseConfig = {
  apiKey: "AIzaSyCE19zdOFwGQyxJSw-idhIjIzLT3a9Wntk",
  authDomain: "deporte-597c6.firebaseapp.com",
  projectId: "deporte-597c6",
  storageBucket: "deporte-597c6.firebasestorage.app",
  messagingSenderId: "140373189508",
  appId: "1:140373189508:web:bd5270d7c79764222273d1"
};
    // --------------------------------------------------

    // Inicializa Firebase y Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Definición de posiciones y ángulos
    const posiciones = [
      { key: 'Poste bajo', label: 'Poste bajo' },
      { key: 'Media', label: 'Media' },
      { key: 'Tiro libre', label: 'Tiro libre' },
      { key: 'Triple', label: 'Triple' }
    ];
    const angulos = [
      { key: '0L', label: '0º L' },
      { key: '30L', label: '30º L' },
      { key: '45L', label: '45º L' },
      { key: '60L', label: '60º L' },
      { key: '90', label: '90º' },
      { key: '60R', label: '60º R' },
      { key: '45R', label: '45º R' },
      { key: '30R', label: '30º R' },
      { key: '0R', label: '0º R' }
    ];

    // Referencias DOM
    const container = document.getElementById('zones-container');
    const submitBtn = document.getElementById('submit-btn');
    const msgDiv = document.getElementById('message');

    // Generar inputs dinámicamente
    // Para cada combinación, se crea un div.zone-card con label y input number
    posiciones.forEach(pos => {
      angulos.forEach(ang => {
        const card = document.createElement('div');
        card.className = 'zone-card';
        // id para referenciar luego: por ejemplo "input-Poste bajo-0L"
        const inputId = `input-${pos.key.replace(/\s+/g, '_')}-${ang.key}`;
        const labelText = `${pos.label} - ${ang.label}`;
        card.innerHTML = `
          <label for="${inputId}">${labelText}</label>
          <input 
            type="number" 
            id="${inputId}" 
            name="${inputId}"
            min="0" max="10" 
            value="" 
            placeholder="0–10"
            inputmode="numeric"
          />
        `;
        container.appendChild(card);
      });
    });

    // Función para leer los valores, validar y enviar a Firestore
    submitBtn.addEventListener('click', async () => {
      msgDiv.textContent = '';
      // Deshabilitar mientras se envía
      submitBtn.disabled = true;
      submitBtn.textContent = 'Guardando...';

      const fechaISO = new Date().toISOString(); // ej. "2025-06-13T...Z"
      const fechaLocal = new Date().toISOString().split('T')[0]; // "YYYY-MM-DD"

      const promesas = [];
      let anyError = false;
      // Recorrer cada combinación de posición+ángulo
      posiciones.forEach(pos => {
        angulos.forEach(ang => {
          const inputId = `input-${pos.key.replace(/\s+/g, '_')}-${ang.key}`;
          const inp = document.getElementById(inputId);
          const valStr = inp.value.trim();
          if (valStr === "") {
            // Si está vacío, interpretamos como 0 aciertos (o ignorar?)
            // Aquí guardamos también 0: si prefieres ignorar, omite este bloque.
            const aciertos = 0;
            // Creamos doc; si quisieras ignorar zonas no trabajadas, salta este addDoc
            promesas.push(
              addDoc(collection(db, "testInicialTiros"), {
                fechaRegistro: serverTimestamp(),
                fechaLocal: fechaLocal,
                posicion: pos.key,
                angulo: ang.key,
                intentos: 10,
                aciertos: aciertos
              }).catch(err => {
                console.error("Error guardando:", err);
                anyError = true;
              })
            );
          } else {
            const aciertosNum = Number(valStr);
            if (isNaN(aciertosNum) || aciertosNum < 0 || aciertosNum > 10) {
              anyError = true;
              console.warn(`Valor inválido en ${pos.key}-${ang.key}: ${valStr}`);
            } else {
              promesas.push(
                addDoc(collection(db, "testInicialTiros"), {
                  fechaRegistro: serverTimestamp(),
                  fechaLocal: fechaLocal,
                  posicion: pos.key,
                  angulo: ang.key,
                  intentos: 10,
                  aciertos: aciertosNum
                }).catch(err => {
                  console.error("Error guardando:", err);
                  anyError = true;
                })
              );
            }
          }
        });
      });

      // Esperar todos los envíos
      try {
        await Promise.all(promesas);
      } catch (e) {
        console.error("Error en Promise.all:", e);
        anyError = true;
      }

      if (anyError) {
        msgDiv.style.color = '#f55';
        msgDiv.textContent = 'Ha ocurrido algún error guardando. Revisa la consola y vuelve a intentarlo.';
      } else {
        msgDiv.style.color = '#0f0';
        msgDiv.textContent = 'Resultados guardados con éxito.';
        // Opcional: limpiar inputs o mantener
        // container.querySelectorAll('input[type="number"]').forEach(i=>i.value='');
      }

      submitBtn.disabled = false;
      submitBtn.textContent = 'Guardar resultados';
    });
  </script>
</body>
</html>
