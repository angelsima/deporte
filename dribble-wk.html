<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>5 min Dribble Workout</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
      padding: 2rem;
    }
    .exercise {
      margin-bottom: 2rem;
      padding: 1rem;
      border: 1px solid #444;
      border-radius: 8px;
      transition: background 0.3s;
    }
    .exercise.done {
      text-decoration: line-through;
      opacity: 0.6;
    }
    .timer {
      font-size: 1.5rem;
      margin-top: 0.5rem;
    }
    .reps {
      margin-top: 0.3rem;
      cursor: pointer;
    }
    .rep-count {
      font-size: 1.8rem;
      font-weight: bold;
      color: #0ff;
    }
    .note {
      font-size: 1rem;
      margin-top: 0.5rem;
      color: #ccc;
    }
    .sets {
      margin-top: 0.5rem;
      font-size: 1.5rem;
    }
    .set {
      margin-right: 0.4rem;
      cursor: pointer;
      user-select: none;
    }
    .set.checked {
      color: #0f0;
    }
    .done {
      text-decoration: line-through;
      opacity: 0.6;
    }
    .timer-controls button {
      font-size: 0.8rem;
      padding: 4px 8px;
      margin: 2px;
    }
    .time-block {
      border-left: 2px solid #555;
      margin: 1rem 0;
      padding-left: 1rem;
    }
    #overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 6rem;
      color: #0f0;
      display: none;
      z-index: 10;
    }
  </style>
</head>
<body>
  <div class="timer-controls">
    <button class="play-btn" id="playBtn">▶</button>
    <button class="stop-btn" id="stopBtn" style="display:none;">■</button>
  </div>
  <div id="exercises"></div>
  <div id="overlay"></div>

  <script>
    const exercises = [
      { text: 'Pound R - Cambiando peso', type: 'time', duration: 2 },
      { text: 'Pound L - Cambiando peso', type: 'time', duration: 2 },
      { text: 'Cross - Cambiando peso', type: 'time', duration: 2 },
      { text: 'Pound + Joke cross', type: 'time', duration: 2 },
      { text: 'Joke cross', type: 'time', duration: 2 },
      { text: 'Pound + BTL + xDetrás', type: 'reps', reps: 10 },
      { text: 'BTL Split', type: 'reps', reps: 20, note: 'Neutro+pound, split+BTL, neutro+pound…' },
      { text: 'Avanzar: Pound + Cross', type: 'reps', reps: 10, sets: 4 },
      { text: 'Avanzar: Pound + BTL', type: 'reps', reps: 10, sets: 4 },
      { text: 'Avanzar: (Pound + Cross) + (Pound + BTL)', type: 'reps', reps: 10, sets: 4 },
    ];

    const exContainer = document.getElementById('exercises');
    const overlay = document.getElementById('overlay');
    const stopBtn = document.getElementById('stopBtn');
    const playBtn = document.getElementById('playBtn');

    function createExerciseElement(ex) {
      const div = document.createElement('div');
      div.className = 'exercise';
      div.innerHTML = `
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <strong>${ex.text}</strong>
          ${ex.type === 'reps' ? `<span class="rep-count">x${ex.reps}</span>` : ''}
        </div>
        ${ex.type === 'time'
          ? `<div class="timer" contenteditable="true">${ex.duration}</div>`
          : `
            <div class="note" contenteditable="true">${ex.note || ''}</div>
            ${ex.sets ? `<div class="sets">${[...Array(ex.sets)].map(() => '<span class="set">◯</span>').join(' ')}</div>` : ''}`}
      `;

      if (ex.type === 'reps' && !ex.sets) {
        div.addEventListener('click', () => div.classList.toggle('done'));
      }

      const setEls = div.querySelectorAll('.set');
      setEls.forEach(set => {
        set.addEventListener('click', (e) => {
          e.stopPropagation();
          set.classList.toggle('checked');
          const allChecked = [...set.parentNode.querySelectorAll('.set')].every(s => s.classList.contains('checked'));
          const exDiv = set.closest('.exercise');
          if (allChecked) {
            exDiv.classList.add('done');
          } else {
            exDiv.classList.remove('done');
          }
        });
      });

      return div;
    }

    let i = 0;
    while (i < exercises.length) {
      if (exercises[i].type === 'time') {
        const block = document.createElement('div');
        block.className = 'time-block';

        while (i < exercises.length && exercises[i].type === 'time') {
          const div = createExerciseElement(exercises[i]);
          block.appendChild(div);
          i++;
        }
        exContainer.appendChild(block);
      } else {
        const div = createExerciseElement(exercises[i]);
        exContainer.appendChild(div);
        i++;
      }
    }

    const beep = () => {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      osc.type = 'square';
      osc.frequency.setValueAtTime(1000, ctx.currentTime);
      osc.connect(ctx.destination);
      osc.start();
      osc.stop(ctx.currentTime + 0.2);
    };

    const sleep = ms => new Promise(res => setTimeout(res, ms));

    let timerInterval = null;

    playBtn.addEventListener('click', async () => {
      const items = document.querySelectorAll('.exercise');
      playBtn.style.display = 'none';
      stopBtn.style.display = 'inline';

      for (let i = 0; i < items.length; i++) {
        const item = items[i];
        const type = exercises[i].type;

        if (type === 'time') {
          let timeEl = item.querySelector('.timer');
          let seconds = parseInt(timeEl.innerText);

          while (seconds > 0) {
            timeEl.innerText = seconds--;
            await sleep(1000);
          }

          beep();
          item.classList.add('done');
          item.style.background = 'green';

          for (let j = 3; j > 0; j--) {
            overlay.innerText = j;
            overlay.style.display = 'flex';
            await sleep(1000);
          }
          overlay.style.display = 'none';
          item.style.background = '';
        }
      }
      playBtn.style.display = 'inline';
      stopBtn.style.display = 'none';
    });

    stopBtn.addEventListener('click', () => {
      if (timerInterval) clearInterval(timerInterval);
      overlay.style.display = 'none';
      stopBtn.style.display = 'none';
      playBtn.style.display = 'inline';
    });
  </script>
</body>
</html>
